# Task Manager - Test Suite

This repository contains the end-to-end test suite for the Task Manager application. It includes a comprehensive set of API and UI tests designed to run in a containerized environment using Docker Compose.

The test environment also includes a fully configured **ELK Stack** (Elasticsearch, Logstash, Kibana) for centralized logging, allowing for easy debugging and analysis of test runs.

## Services

This `docker-compose` setup orchestrates the following services:

- **taskmanager-app**: The Spring Boot application under test.
- **db**: A PostgreSQL database used by the application.
- **selenoid**: A robust Selenium Hub implementation for running UI tests in isolated Docker containers.
- **tests**: The main test runner container that executes the Gradle test suite.
- **elasticsearch**: Stores and indexes logs from all services.
- **logstash**: Processes and forwards logs from containers to Elasticsearch.
- **kibana**: A web interface for searching, analyzing, and visualizing the collected logs.

## Prerequisites

- Docker
- Docker Compose

## How to Run Locally

1.  **Start the entire stack**:

    From the root of the project, run the following command. This will build all necessary images and start all services in detached mode.

    ```bash
    docker-compose up -d --build
    ```

2.  **Test Execution**:

    The `tests` container will start automatically after all other services are healthy. It will first pull the required browser images for Selenoid and then execute the Gradle test suite.

3.  **Stopping the Environment**:

    Once you are finished, you can stop all running services with:

    ```bash
    docker-compose down
    ```

    To also remove the persistent data volumes for PostgreSQL and Elasticsearch, use the `-v` flag:

    ```bash
    docker-compose down -v
    ```

## Viewing Logs in Kibana

After a successful run, logs from all services are available in Kibana.

1.  **Access Kibana**: Open your web browser and navigate to `http://localhost:5601`.

2.  **Create an Index Pattern**:
    - Open the main menu (☰) and go to **Stack Management** -> **Index Patterns**.
    - Click **Create index pattern**.
    - For the name, enter `logstash-*`.
    - Select `@timestamp` as the time field.
    - Click **Create index pattern**.

3.  **Discover Logs**:
    - Open the main menu (☰) and go to **Analytics** -> **Discover**.
    - You should now see logs from all services. You can use the search bar and filters to narrow down the results (e.g., filter by `container_name: taskmanager-tests`).

## Viewing Test Reports

The Allure test report is generated by the `tests` container after the test run completes.

- **Location**: The report is available in the `build/allure-report` directory on your host machine.
- **How to View**: Open the `build/allure-report/index.html` file in your web browser.
